# 设计一款分布式数据库 #
随着不断变化的需求和不断增加的数据量，越来越多的新型数据库，如hbase、mongodb、cassandra等，逐渐在一些领域取代了传统的关系型数据库，收到的越来越广泛的关注。
## 单机数据库设计 ##
对于任意一款软件,最重要的是它的设计思想和解决的问题.如程序语言一样,是面向对象,还是面向过程?是性能至上,还是开发效率优先?任何一种语言或软件,如果能解决一个甚至多个核心痛点,即使在其他方面有一些短板,也必然会受到追捧.除了设计思想,软件的架构也是十分重要的.初始架构的设计往往决定了它以后的发展.可扩展性,功能模块的添加和适配,性能的优化等等都会受到架构的影响,重构总是要付出很大代价的,所以核心模块和接口的设计,一定要谨慎决策.核心架构决定了一款软件的起点,设计思想决定了一款软件的终点.

首先，我们要简化思路,先设计在单机可上用的存储引擎和数据结构,然后再考虑分布式数据库所需要的譬如横向扩展,一致性,数据备份等等一系列问题.现在,我们先看看单机运行的数据库应该有哪些模块.为了快速搭起架子，我们先抛开性能和复杂的逻辑，一切以最简单的逻辑来完成。
首先,是核心模块的设计.预先设计的模块主要有文件系统（FileSystem),IO（文件读写）,NET（RPC）,读写缓存cache（Memtable），内存管理，磁盘存储(SSTable，类似HBase的storefile)，日志系统(commitlog)，服务（service)。
单机扩展到集群后，会增加一致性，分区路由，数据传输等模块，单机下的一些模块也会有所变化。

### 文件系统 ###
首先，我们设计文件系统接口IFileSystem(所有非功能接口我们都加上前缀I).为什么要设计这个接口，默认我们使用基于服务器的本地文件系统来操作文件。在这里，我的想法是为了以后适配hdfs等其他厂商自定义的文件系统。

### 存储单元 ###
存储模块,我们借鉴Hbase和Cassandra的设计思想,采用列示存储.其中主要是借鉴Cassandra的存储结构,仍然以行为单位进行存储.Hbase的列存储,每一个单独的cell都存储了大量重复的字段,如果表的列设计过多,会浪费大量的存储.
#### Colum设计 ####
最底层存储单元,我们设计IColumn接口,方法暂定为获取ColumnName,ColumnValue,Timestamp,Type(插入,删除);
#### ColumFamily设计 ####
#### Memtable设计 ####
### 磁盘存储 ###
#### StoreFile ####
### 数据写入 ###
#### StoreFileWriter ####
### 数据读取 ###
### 文件合并 ###
### 本地server设计 ###
## 集群设计 ##
### p2p gossip协议 ###
### 数据写入与一致性hash ###
### 数据最终一致性 ###
### 分布式数据读取 ###
## api设计 ##
### 新建 ###
### 插入 ###
### 更新 ###
### 删除 ###

